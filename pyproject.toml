[project]
name = "cumulus-library"
version = "0.1.0"
# In order to support 3.12, we wil need to refactor out load_module, which is
# targeted for deprecation in that version.
requires-python = ">= 3.9, <3.12"
dependencies = [
    "ctakesclient >= 1.3",
    "fhirclient >= 4.1",
    "Jinja2 > 3",
    "pandas <2, >=1.5.0",
    "pyarrow >= 11.0",
    "pyathena >= 2.23",
    "requests >= 2.28",
    "rich >= 13.2",
    "toml >= 0.10"
]
description = "SQL generation for cumulus clinical studies"
readme = "README.md"
license = { text="Apache License 2.0" }
classifiers = [
    "License :: OSI Approved :: Apache Software License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Topic :: Software Development :: Libraries :: Python Modules",
]

[project.scripts]
cumulus-library = "cumulus_library.cli:main"

[build-system]
requires = ["flit_core >=3.4,<4"]
build-backend = "flit_core.buildapi"

[project.optional-dependencies]

dev = [
    "black",
    "pylint",
    # There are some bugfix actions occuring in sqlfluff that are currently
    # breaking autoformatting for CTAS queries - pinning until this shakes out
    "sqlfluff == 2.0.2"
]

test = [
    "pytest",
]

[tool.sqlfluff.core]
templater = "jinja"
dialect = "athena"
sql_file_exts = ".sql,.sql.jinja"
# this rule overfires on athena nested arrays
exclude_rules="references.from,structure.column_order"
max_line_length = 88

[tool.sqlfluff.indentation]
template_blocks_indent = false

[tool.sqlfluff.rules.layout.long_lines]
ignore_comment_lines = true

[tool.sqlfluff.rules.capitalisation.keywords]
capitalisation_policy = "upper"

[tool.sqlfluff.templater.jinja.context]
schema_name = "test_schema"
table_name = "test_table"
view_or_table_name = "test_view_or_table"
view_or_table = "TABLE"
prefix = "Test"
dataset = [["foo","foo"],["bar","bar"]]
table_cols = ["a","b"]
col_type_list = ["a string","b string"]
